{% extends "base.html" %} {% block content %}
<h2>Past Readings</h2>
<p>Here you can see the historical data from your devices.</p>

<div class="accordion" id="devicesAccordion">
  {% for device in user.devices %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading{{ device.id }}">
      <button
        class="accordion-button collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapse{{ device.id }}"
        aria-expanded="false"
        aria-controls="collapse{{ device.id }}"
      >
        {{ device.name }} ({{ device.device_code }})
      </button>
    </h2>
    <div
      id="collapse{{ device.id }}"
      class="accordion-collapse collapse"
      aria-labelledby="heading{{ device.id }}"
      data-bs-parent="#devicesAccordion"
    >
      <div class="accordion-body">
        {% if device.readings %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Timestamp (UTC)</th>
              <th>Temperature (&deg;C)</th>
              <th>Pressure (hPa)</th>
              <th>Humidity (%)</th>
            </tr>
          </thead>
          <tbody>
            {% for reading in device.readings|sort(attribute='timestamp',
            reverse=True) %}
            <tr>
              <td>{{ reading.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
              <td>
                {% if reading.temperature is not none %}
                  {{ '%.2f'|format(reading.temperature) }}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>
                {% if reading.pressure is not none %}
                  {{ '%.2f'|format(reading.pressure) }}
                {% else %}
                  N/A
                {% endif %}
              </td>
              <td>
                {% if reading.humidity is not none %}
                  {{ '%.2f'|format(reading.humidity) }}
                {% else %}
                  N/A
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>No readings recorded for this device yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {% else %}
  <p>You have no registered devices.</p>
  {% endfor %}
</div>

{% endblock %}
